<!DOCTYPE html>
<html>
  <head>
    <title>Flappy Bird Deluxe</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        user-select: none;
      }

      body {
        background: url("https://img.freepik.com/premium-photo/unraveling-artistry-background-image-flappy-bird-s-stylistic-appeal-game-design-secre_983420-24408.jpg?w=1060");
        background-repeat: no-repeat;
        background-size: cover;
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        /* background: linear-gradient(135deg, #1a1c20 0%, #2c3e50 100%); */
      }

      .game-wrapper {
        position: relative;
        display: flex;
        flex-direction: column;
        gap: 20px;
      }

      .control-panel {
        display: flex;
        justify-content: space-between;
        align-items: center;
        width: 800px;
        background: rgba(16, 54, 94, 0.8);
        padding: 15px;
        border-radius: 10px;
        color: white;
      }

      .stats {
        display: flex;
        gap: 20px;
      }

      .stat-item {
        display: flex;
        flex-direction: column;
        align-items: center;
      }

      .stat-value {
        font-size: 24px;
        font-weight: bold;
        color: #e1dfdf;
      }

      .stat-label {
        font-size: 12px;
        color: #8c9eac;
      }

      .game-controls {
        display: flex;
        gap: 10px;
      }

      .control-btn {
        padding: 8px 15px;
        border: none;
        border-radius: 5px;
        background: #4dc1f9;
        color: white;
        cursor: pointer;
        transition: all 0.2s;
        display: flex;
        align-items: center;
        gap: 5px;
      }

      .control-btn:hover {
        background: #3aa8e0;
        transform: translateY(-2px);
      }

      .game-container {
        width: 800px;
        height: 600px;
        background: linear-gradient(180deg, #4dc1f9 0%, #73d6fd 100%);
        border-radius: 15px;
        overflow: hidden;
        position: relative;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
      }

      #bird {
        position: absolute;
        width: 34px;
        height: 24px;
        background: #ffd542;
        border-radius: 50% 50% 25% 25%;
        transition: transform 0.1s;
        margin-left: 50px;
      }

      #bird::before {
        content: "";
        position: absolute;
        top: 8px;
        right: -4px;
        width: 12px;
        height: 8px;
        background: #ff9c42;
        border-radius: 50%;
      }

      #bird::after {
        content: "";
        position: absolute;
        top: 6px;
        right: 4px;
        width: 5px;
        height: 5px;
        background: #000;
        border-radius: 50%;
      }

      .pipe {
        position: absolute;
        width: 60px;
        background: linear-gradient(90deg, #2ecc71 0%, #27ae60 100%);
        border: 2px solid rgba(0, 0, 0, 0.1);
      }

      .pipe-top {
        border-bottom: none;
        border-bottom-left-radius: 5px;
        border-bottom-right-radius: 5px;
      }

      .pipe-bottom {
        border-top: none;
        border-top-left-radius: 5px;
        border-top-right-radius: 5px;
      }

      #ground {
        position: absolute;
        bottom: 0;
        width: 100%;
        height: 100px;
        background: linear-gradient(90deg, #8b6b61 0%, #795548 100%);
      }

      .screen {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        backdrop-filter: blur(5px);
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        color: white;
        gap: 20px;
      }

      .screen h1 {
        font-size: 48px;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        margin-bottom: 10px;
      }

      .score {
        position: absolute;
        top: 20px;
        width: 100%;
        text-align: center;
        font-size: 48px;
        font-weight: bold;
        color: white;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        z-index: 10;
      }

      .speed-control {
        display: flex;
        align-items: center;
        gap: 10px;
        background: rgba(255, 255, 255, 0.1);
        padding: 5px 10px;
        border-radius: 5px;
      }

      .speed-value {
        min-width: 30px;
        text-align: center;
      }

      .message {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        color: white;
        font-size: 24px;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        opacity: 0;
        transition: opacity 0.3s;
      }

      .message.show {
        opacity: 1;
      }
    </style>
  </head>
  <body>
    <div class="game-wrapper">
      <div class="control-panel">
        <div class="stats">
          <div class="stat-item">
            <div class="stat-value" id="score">0</div>
            <div class="stat-label">Current Score</div>
          </div>
          <div class="stat-item">
            <div class="stat-value" id="highScore">0</div>
            <div class="stat-label">High Score</div>
          </div>
          <div class="stat-item">
            <div class="stat-value" id="attempts">0</div>
            <div class="stat-label">Attempts</div>
          </div>
        </div>
        <div class="game-controls">
          <div class="speed-control">
            <button class="control-btn" onclick="game.decreaseSpeed()">
              <i class="fas fa-minus"></i>
            </button>
            <div class="speed-value" id="speedValue">1x</div>
            <button class="control-btn" onclick="game.increaseSpeed()">
              <i class="fas fa-plus"></i>
            </button>
          </div>
          <button class="control-btn" id="pauseBtn">
            <i class="fas fa-pause"></i> Pause
          </button>
          <button class="control-btn" onclick="game.restart()">
            <i class="fas fa-redo"></i> Restart
          </button>
        </div>
      </div>

      <div class="game-container">
        <div class="score">0</div>
        <div id="bird"></div>
        <div id="ground"></div>
        <div class="message">Get Ready!</div>
        <div class="screen">
          <h1>Flappy Bird Deluxe</h1>
          <p>Press SPACE or CLICK to jump</p>
          <button class="control-btn" onclick="game.startGame()">
            <i class="fas fa-play"></i> Start Game
          </button>
        </div>
      </div>
    </div>

    <script>
      class FlappyBird {
        constructor() {
          this.initializeElements();
          this.initializeState();
          this.setupEventListeners();
        }

        initializeElements() {
          this.gameContainer = document.querySelector(".game-container");
          this.bird = document.querySelector("#bird");
          this.scoreDisplays = document.querySelectorAll(".score, #score");
          this.highScoreDisplay = document.querySelector("#highScore");
          this.attemptsDisplay = document.querySelector("#attempts");
          this.startScreen = document.querySelector(".screen");
          this.message = document.querySelector(".message");
          this.pauseBtn = document.querySelector("#pauseBtn");
          this.speedDisplay = document.querySelector("#speedValue");
        }

        initializeState() {
          this.gameWidth = 800;
          this.gameHeight = 600;
          this.birdX = 150;
          this.birdY = 250;
          this.birdVelocity = 0;
          this.birdGravity = 0.35;
          this.birdLift = -6.5;
          this.score = 0;
          this.highScore = parseInt(localStorage.getItem("highScore")) || 0;
          this.attempts = parseInt(localStorage.getItem("attempts")) || 0;
          this.pipes = [];
          this.gameLoop = null;
          this.gameStarted = false;
          this.isGameOver = false;
          this.isPaused = false;
          this.pipeSpeed = 2;
          this.speedMultiplier = 1;

          this.updateDisplays();
        }

        setupEventListeners() {
          document.addEventListener("keydown", (e) => {
            if (e.code === "Space") {
              e.preventDefault();
              if (!this.gameStarted) {
                this.startGame();
              }
              this.jump();
            } else if (e.code === "Escape") {
              this.togglePause();
            }
          });

          this.gameContainer.addEventListener("click", () => {
            if (!this.gameStarted) {
              this.startGame();
            }
            this.jump();
          });

          this.pauseBtn.addEventListener("click", (e) => {
            e.stopPropagation();
            this.togglePause();
          });
        }

        togglePause() {
          if (!this.gameStarted || this.isGameOver) return;

          this.isPaused = !this.isPaused;
          this.pauseBtn.innerHTML = this.isPaused
            ? '<i class="fas fa-play"></i> Resume'
            : '<i class="fas fa-pause"></i> Pause';

          if (this.isPaused) {
            cancelAnimationFrame(this.gameLoop);
            this.showMessage("PAUSED");
          } else {
            this.hideMessage();
            this.update();
          }
        }

        showMessage(text, duration = 0) {
          this.message.textContent = text;
          this.message.classList.add("show");
          if (duration > 0) {
            setTimeout(() => this.hideMessage(), duration);
          }
        }

        hideMessage() {
          this.message.classList.remove("show");
        }

        increaseSpeed() {
          if (this.speedMultiplier < 2) {
            this.speedMultiplier += 0.25;
            this.updateSpeedDisplay();
          }
        }

        decreaseSpeed() {
          if (this.speedMultiplier > 0.5) {
            this.speedMultiplier -= 0.25;
            this.updateSpeedDisplay();
          }
        }

        updateSpeedDisplay() {
          this.speedDisplay.textContent = `${this.speedMultiplier}x`;
        }

        updateDisplays() {
          this.scoreDisplays.forEach(
            (display) => (display.textContent = this.score)
          );
          this.highScoreDisplay.textContent = this.highScore;
          this.attemptsDisplay.textContent = this.attempts;
        }

        startGame() {
          this.attempts++;
          localStorage.setItem("attempts", this.attempts);
          this.updateDisplays();

          // Clean up any existing pipes
          this.pipes.forEach((pipe) => {
            if (pipe.topPipe.parentNode) pipe.topPipe.remove();
            if (pipe.bottomPipe.parentNode) pipe.bottomPipe.remove();
          });

          this.gameStarted = true;
          this.isGameOver = false;
          this.isPaused = false;
          this.startScreen.style.display = "none";
          this.score = 0;
          this.birdY = 250;
          this.birdVelocity = 0;
          this.pipes = [];

          this.showMessage("GO!", 1000);

          if (this.gameLoop) cancelAnimationFrame(this.gameLoop);
          this.createPipe();
          this.update();
        }

        jump() {
          if (this.isGameOver || this.isPaused) return;
          this.birdVelocity = this.birdLift;
        }

        createPipe() {
          const gap = 190;
          const minHeight = 50;
          const maxHeight = this.gameHeight - gap - minHeight - 100;
          const height = Math.random() * (maxHeight - minHeight) + minHeight;

          const topPipe = document.createElement("div");
          topPipe.className = "pipe pipe-top";
          topPipe.style.right = "-60px";
          topPipe.style.height = `${height}px`;
          topPipe.style.top = "0";

          const bottomPipe = document.createElement("div");
          bottomPipe.className = "pipe pipe-bottom";
          bottomPipe.style.right = "-60px";
          bottomPipe.style.height = `${this.gameHeight - height - gap - 100}px`;
          bottomPipe.style.bottom = "100px";

          this.gameContainer.appendChild(topPipe);
          this.gameContainer.appendChild(bottomPipe);

          this.pipes.push({
            x: this.gameWidth,
            topPipe,
            bottomPipe,
            scored: false,
          });
        }

        update() {
          if (this.isGameOver || this.isPaused) return;

          // Update bird
          this.birdVelocity += this.birdGravity;
          this.birdY += this.birdVelocity;

          // Ground collision
          if (this.birdY > this.gameHeight - 130) {
            this.gameOver();
            return;
          }

          // Ceiling collision
          if (this.birdY < 0) {
            this.birdY = 0;
            this.birdVelocity = 0;
          }

          // Update bird position and rotation
          const rotation = Math.max(-20, Math.min(20, this.birdVelocity * 2));
          this.bird.style.transform = `translateY(${this.birdY}px) rotate(${rotation}deg)`;

          // Update pipes
          for (let i = this.pipes.length - 1; i >= 0; i--) {
            const pipe = this.pipes[i];
            pipe.x -= this.pipeSpeed * this.speedMultiplier;

            pipe.topPipe.style.right = `${this.gameWidth - pipe.x}px`;
            pipe.bottomPipe.style.right = `${this.gameWidth - pipe.x}px`;

            // Check collision with reduced collision box
            const birdBox = {
              left: this.birdX + 5, // Reduced collision box
              right: this.birdX + 29, // Reduced collision box
              top: this.birdY + 5, // Reduced collision box
              bottom: this.birdY + 19, // Reduced collision box
            };

            const pipeBox = {
              left: pipe.x - 2, // Reduced collision box
              right: pipe.x + 58, // Reduced collision box
              topBottom: parseInt(pipe.topPipe.style.height),
              bottomTop:
                this.gameHeight - parseInt(pipe.bottomPipe.style.height) - 100,
            };

            // Collision detection
            if (
              birdBox.right > pipeBox.left &&
              birdBox.left < pipeBox.right &&
              (birdBox.top < pipeBox.topBottom ||
                birdBox.bottom > pipeBox.bottomTop)
            ) {
              this.gameOver();
              return;
            }

            // Score point
            if (!pipe.scored && pipe.x < this.birdX) {
              pipe.scored = true;
              this.score++;
              this.updateDisplays();
              this.showMessage("+1", 500);
            }

            // Remove pipes that are off screen
            if (pipe.x < -60) {
              this.gameContainer.removeChild(pipe.topPipe);
              this.gameContainer.removeChild(pipe.bottomPipe);
              this.pipes.splice(i, 1);
            }
          }

          // Create new pipes
          if (
            this.pipes.length === 0 ||
            this.pipes[this.pipes.length - 1].x < this.gameWidth - 300
          ) {
            this.createPipe();
          }

          this.gameLoop = requestAnimationFrame(() => this.update());
        }

        gameOver() {
          this.isGameOver = true;
          cancelAnimationFrame(this.gameLoop);

          if (this.score > this.highScore) {
            this.highScore = this.score;
            localStorage.setItem("highScore", this.score);
            this.showMessage("NEW HIGH SCORE!", 2000);
          }

          // Create and show game over screen
          const gameOverScreen = document.createElement("div");
          gameOverScreen.className = "screen";
          gameOverScreen.innerHTML = `
                    <h1>Game Over!</h1>
                    <div style="text-align: center; margin: 20px 0;">
                        <p style="font-size: 24px; margin-bottom: 10px;">Score: ${this.score}</p>
                        <p style="font-size: 20px;">High Score: ${this.highScore}</p>
                        <p style="font-size: 16px; margin-top: 10px;">Total Attempts: ${this.attempts}</p>
                    </div>
                    <button class="control-btn" onclick="game.restart()">
                        <i class="fas fa-redo"></i> Play Again
                    </button>
                `;

          this.gameContainer.appendChild(gameOverScreen);
        }

        restart() {
          // Remove game over screen if it exists
          const gameOverScreen = this.gameContainer.querySelector(".screen");
          if (gameOverScreen) {
            this.gameContainer.removeChild(gameOverScreen);
          }
          this.startGame();
        }
      }

      // Initialize the game
      const game = new FlappyBird();
    </script>
  </body>
</html>
